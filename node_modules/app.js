var app=require('express').createServer();
var io=require('socket.io').listen(app);
app.listen(8080);
app.get('/',function(req,res){
	res.sendfile(__dirname+'/chat.html');
});
var usernames={};
io.sockets.on('connection',function(socket){
	socket.on('sendchat',function(data){
			io.sockets.emit('udpatechat',socket.username,data);
	});
	socket.on('adduser',function(username){
			socket.username=username;
			usernames[username]=username;
			socket.emit('updatechat', 'SERVER', 'you have connected');
			socket.broadcast.emit('updatechat', 'SERVER', username + ' has connected');
			io.sockets.emit('updateusers', usernames);
	});
	socket.on('disconnect', function(){
		delete usernames[socket.usernames];
		io.sockets.emit('updateusers',usernames);
		socket.broadcast.emit('updatechat', 'SERVER', socket.username + ' has disconnected');
	});
});