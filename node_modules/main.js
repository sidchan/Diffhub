var patch;
var diffs;
var patchText="";
var timer;
var dmp=new diff_match_patch();
function textChange()
{
	contents=document.getElementById("realTimeTextarea").value;
	if(timer!=undefined)
		clearTimeout(timer);
	timer=setTimeout(function(){
	diff_call(contents);
	},1000);
}
now.sendDiffsResponse=function(getDiffs)
{
	patch=dmp.patch_make(patchText,getDiffs);
	results=dmp.patch_apply(patch,patchText);
	patchText=results[0];
	document.getElementById("realTimeTextarea").value=patchText;
}
function diff_call(contents)
 {
  diffs=dmp.diff_main(patchText,contents);
  now.sendDiffs(diffs);
 }
window.onload=function()
{
	if(document.getElementById("rootDiv").childNodes.length)
	{
		document.getElementById("createButton").onclick=function()
		{
			var editorName=document.getElementById("createEditor").value;
			window.location=editorName;
		}
	}
	else
	{
				var textarea=document.createElement("textarea");
				textarea.id="realTimeTextarea";
				textarea.setAttribute("onkeyup","textChange()");
				document.getElementById("mainDiv").innerHTML="";
				document.getElementById("mainDiv").appendChild(textarea);
	}
}